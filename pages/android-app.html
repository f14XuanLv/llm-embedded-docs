<h1>手机离线/在线多模态智能助理应用规划</h1>

<h2>系统概览</h2>

<h3>硬件接口</h3>
<ul>
    <li>摄像头（优先使用低分辨率压缩模式以减少处理负担）</li>
    <li>麦克风（语音输入）</li>
    <li>扬声器（语音输出）</li>
</ul>

<h3>网络模式</h3>
<ul>
    <li>离线模式（默认，优先完成）</li>
    <li>在线模式（预留接口，便于后续扩展）</li>
</ul>

<h2>模型选择</h2>

<h3>1. 基础语言/图像模型</h3>
<p>针对芯片架构模型转换和推理优化的 Gemma 3 系列模型</p>

<h3>2. 音频与语音识别模型</h3>
<p>预计选择使用以下轻量级模型：</p>

<ol>
    <li><strong>Whisper Tiny</strong>
        <ul>
            <li>大小：约39MB</li>
            <li>特点：超轻量级，适合手机离线使用，支持多种语言</li>
            <li>精度：足够日常使用，响应速度快</li>
        </ul>
    </li>
    <li><strong>NVIDIA Nemo RNNT</strong>
        <ul>
            <li>大小：50-80MB (精简版)</li>
            <li>特点：实时转录，低延迟，适合连续对话场景</li>
            <li>支持中英文等多种语言</li>
        </ul>
    </li>
</ol>

<h3>3. 文字转音频模型</h3>
<p>预计选择以下轻量级TTS模型：</p>

<ol>
    <li><strong>VITS-CJE</strong>
        <ul>
            <li>大小：约50MB</li>
            <li>特点：支持中日英三语，音质自然，适合离线场景</li>
            <li>延迟低，适合实时对话</li>
        </ul>
    </li>
    <li><strong>Piper TTS</strong>
        <ul>
            <li>大小：20-40MB (根据语音库)</li>
            <li>特点：开源、轻量级、多语言支持</li>
            <li>支持自定义声音</li>
        </ul>
    </li>
</ol>

<h3>4. 超高速小语言模型</h3>
<p>预计选择用于快速判断是否需要图片的模型：</p>

<ol>
    <li><strong>MobileViT v2</strong>
        <ul>
            <li>大小：约4MB</li>
            <li>特点：专为移动设备优化的视觉transformer</li>
            <li>可训练为二分类器，判断用户请求是否需要图像辅助</li>
        </ul>
    </li>
    <li><strong>MobileBERT</strong>
        <ul>
            <li>大小：约25MB</li>
            <li>特点：专为移动设备优化的BERT模型</li>
            <li>速度快，可用于简单的文本分类任务</li>
        </ul>
    </li>
</ol>

<h2>UI设计</h2>

<h3>主页</h3>
<p>显示四个主要功能按钮，布局清晰：</p>
<ol>
    <li>传统聊天界面</li>
    <li>纯语音对话界面</li>
    <li>多模态互动界面</li>
    <li>对话历史（可查看和删除聊天记录）</li>
</ol>

<h3>传统聊天界面</h3>
<ul>
    <li><strong>底部</strong>：输入框，右侧是发送按钮，左侧是附加图片按钮</li>
    <li><strong>图片预览模式</strong>：选择图片后聊天框UI变高，划分为两个区域
        <ul>
            <li>上3/4区域：要发送的图片预览</li>
            <li>下1/4区域：文本输入框</li>
        </ul>
    </li>
    <li><strong>左上角</strong>：纯语音对话按钮，点击进入纯语音对话模式</li>
    <li><strong>右上角</strong>：摄像头按钮
        <ul>
            <li>单击：拍照，自动保存到相册，聊天框UI变化同选择相册图片</li>
            <li>长按：进入多模态互动界面</li>
        </ul>
    </li>
</ul>

<h3>纯语音对话界面</h3>
<ul>
    <li><strong>底部</strong>：显示实时音频波形图</li>
    <li><strong>自动流程</strong>：
        <ul>
            <li>麦克风自动打开，检测用户语音</li>
            <li>自动识别语音内容并在右侧聊天泡泡中显示</li>
            <li>处理后的文本回复通过扬声器播放</li>
            <li>播放时左侧聊天泡泡流式显示文本内容</li>
        </ul>
    </li>
    <li><strong>UI特点</strong>：屏幕自适应、聊天记录列表下拉、聊天泡泡高度自适应</li>
</ul>

<h3>多模态互动界面</h3>
<ul>
    <li><strong>摄像头</strong>：自动开启，可切换前后摄像头</li>
    <li><strong>自动拍照</strong>：每2秒拍照一次，队列保存最近10张</li>
    <li><strong>数据结构</strong>：记录图片和对应拍摄时间</li>
    <li><strong>底部</strong>：音频波形图</li>
    <li><strong>交互流程</strong>：
        <ul>
            <li>检测用户说话，记录结束时间currentTime</li>
            <li>使用小语言模型判断是否需要附带图片</li>
            <li>如输出1：选择时间戳最接近currentTime的图片，与文本一起发送</li>
            <li>如输出0：仅发送文本</li>
            <li>生成回复并播放音频</li>
        </ul>
    </li>
</ul>

<h3>对话历史</h3>
<ul>
    <li><strong>功能</strong>：查看和删除聊天记录</li>
    <li><strong>数据存储</strong>：使用适合的数据结构存储会话记录
        <ul>
            <li>可使用JSON格式或其他适合安卓的格式</li>
            <li>图片使用本地路径存储，不使用base64格式</li>
        </ul>
    </li>
</ul>

<h4>图片存储预计优化方案</h4>
<ul>
    <li>图片存储于应用专用目录，使用文件路径引用</li>
    <li>缩略图生成与缓存机制，减少内存使用</li>
    <li>定期清理临时拍摄的图片，保留重要对话图片</li>
    <li>采用应用专用的轻量级数据库（如SQLite）存储索引</li>
</ul>

<h2>性能优化</h2>

<h3>模型加载策略</h3>
<ol>
    <li>冷启动优化：
        <ul>
            <li>首次启动时加载最小必要组件</li>
            <li>后台异步加载其他模型</li>
            <li>显示加载进度条</li>
        </ul>
    </li>
    <li>内存管理：
        <ul>
            <li>根据设备规格（骁龙870处理器、12+4GB运行内存）合理分配模型资源</li>
            <li>非活跃界面的模型可释放内存，切换时重新加载</li>
        </ul>
    </li>
</ol>